<!DOCTYPE html>
<!--[if IE]><![endif]-->
<html>
  
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <title>Main Loop Programming Guide in C# </title>
    <meta name="viewport" content="width=device-width">
    <meta name="title" content="Main Loop Programming Guide in C# ">
    <meta name="generator" content="docfx 2.45.0.0">
    
    <link rel="shortcut icon" href="../../../../../../../e-logo-title.png">
    <link rel="stylesheet" href="../../../../../../../styles/docfx.vendor.css">
    <link rel="stylesheet" href="../../../../../../../styles/docfx.css">
    <link rel="stylesheet" href="../../../../../../../styles/main.css">
    <meta property="docfx:navrel" content="../../../../../../../toc.html">
    <meta property="docfx:tocrel" content="../../../../../../toc.html">
    
    
    
  </head>
  <body data-spy="scroll" data-target="#affix" data-offset="120">
    <div id="wrapper">
      <header>
        
        <nav id="autocollapse" class="navbar navbar-inverse ng-scope" role="navigation">
          <div class="container">
            <div class="navbar-header">
              <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#navbar">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
              </button>
              
              <a class="navbar-brand" href="../../../../../../../index.html">
                <img id="logo" class="svg" src="../../../../../../../e-logo-title.png" alt="">
              </a>
            </div>
            <div class="collapse navbar-collapse" id="navbar">
              <form class="navbar-form navbar-right" role="search" id="search">
                <div class="form-group">
                  <input type="text" class="form-control" id="search-query" placeholder="Search" autocomplete="off">
                </div>
              </form>
            </div>
          </div>
        </nav>
        
        <div class="subnav navbar navbar-default">
          <div class="container hide-when-search" id="breadcrumb">
            <ul class="breadcrumb">
              <li></li>
            </ul>
          </div>
        </div>
      </header>
      <div role="main" class="container body-content hide-when-search">
        
        <div class="sidenav hide-when-search">
          <a class="btn toc-toggle collapse" data-toggle="collapse" href="#sidetoggle" aria-expanded="false" aria-controls="sidetoggle">Show / Hide Table of Contents</a>
          <div class="sidetoggle collapse" id="sidetoggle">
            <div id="sidetoc"></div>
          </div>
        </div>
        <div class="article row grid-right">
          <div class="col-md-10">
            <article class="content wrap" id="_content" data-uid="">
<h1 id="main-loop-programming-guide-in-c">Main Loop Programming Guide in C#</h1>

<p>The EFL is event-driven. This means that execution usually takes place within an internal EFL <em>Main Loop</em>. The application is notified through function callbacks of virtually any event happening on the computer. This is typically more efficient than <em>polling</em> for events, whereby the application has to repeatedly ask if a certain event has occurred. When nothing is happening (no events are pending) the main loop enters the <em>idle state</em> during which the CPU consumes very little power.</p>
<p>EFL manages timers and user interface events amongst many other things and even provides a simple mechanism for applications to perform conventional data polling if required.</p>
<table>
<thead>
<tr>
<th></th>
<th>WARNING</th>
<th></th>
</tr>
</thead>
<tbody>
<tr>
<td><img src="../../../../../../../images/note-important.png" alt="NOTE"></td>
<td><strong>Some C# classes are currently in BETA state</strong><br>They should only be used for experimenting and <strong>NOT</strong> for any product development.<br>These classes are marked as <strong>BETA</strong> in the reference documentation.<br>The source code for the tutorials is subject to change in the future.</td>
<td><img src="../../../../../../../images/note-important.png" alt="NOTE"></td>
</tr>
</tbody>
</table>
<h2 id="prerequisites">Prerequisites</h2>
<ul>
<li>Read the <a href="../../../tutorials/csharp/hello-world-cs.html">Hello World in C#</a> tutorial to learn how to instantiate EFL objects.</li>
<li>Read the <a href="events.html">Events Programming Guide</a> to learn how to register callbacks, which can be triggered by events.</li>
</ul>
<h2 id="the-application-main-loop">The Application Main Loop</h2>
<p>For convenience, when your application starts, EFL creates one Main Loop for you, called the <em>Application Main Loop</em>. You can use it as the parent for any object you create that requires a main loop.</p>
<p>In the <a href="../../../tutorials/csharp/hello-world-cs.html">Hello World</a> tutorial you learned that you can retrieve the Application Main Loop like this:</p>
<pre><code class="lang-csharp">var mainloop = Efl.App.GetLoopMain();
</code></pre>
<p>This guide will put the application's main loop to a variety of uses.</p>
<h2 id="timers">Timers</h2>
<p>Timers allow events to be triggered periodically after the given time has elapsed. After an event callback has been registered with the timer, it will be called at regular intervals.</p>
<p>You can find usage examples in the <a href="https://git.enlightenment.org/tools/examples.git">EFL examples repository</a>: <a href="https://git.enlightenment.org/tools/examples.git/tree/reference/csharp/core/src/core_idler.cs"><code>reference/csharp/core/src/core_idler.cs</code></a> and <a href="https://git.enlightenment.org/tools/examples.git/tree/reference/csharp/core/src/core_poll.cs"><code>reference/csharp/core/src/core_poll.cs</code></a>.</p>
<h3 id="creating-and-destroying-timers">Creating and Destroying Timers</h3>
<p>Timers are EFL objects. You can create them with the <code>new</code> operator as all other EFL objects, with an optional parent and initialization method (as seen in the <a href="../../../tutorials/csharp/hello-world-cs.html">Hello World in C#</a> tutorial):</p>
<pre><code class="lang-csharp">var timer_object = new Efl.LoopTimer(mainloop, (Efl.LoopTimer etimer) =&gt; {
    // Timer configuration
});
</code></pre>
<p>Timers do not need to have a parent. However it is convenient to create them under the application Main Loop, so the parent can manage destroying the timer.</p>
<h3 id="the-timer-callback">The Timer Callback</h3>
<p>Register the callback using the <code>+=</code> operator as explained in the <a href="events.html">Events Programming Guide</a>, and the <code>TickEvt</code> event.</p>
<pre><code class="lang-csharp">timer_object.TickEvt += (object sender, EventArgs e) =&gt; {
  Console.WriteLine(&quot;TIMER: timer callback called&quot;);
};
</code></pre>
<p>The callback has the usual event handler signature:</p>
<pre><code class="lang-csharp">void callback(object sender, EventArgs e);
</code></pre>
<p>This callback will be continuously triggered in the configured time intervals.</p>
<h3 id="configuring-a-timer">Configuring a Timer</h3>
<p>The <code>Interval</code> property controls the amount of time between callback triggers in <strong>seconds</strong>:</p>
<pre><code class="lang-csharp">timer_object.SetInterval(0.01); // In seconds
timer_object.GetInterval();
timer_object.Interval = 0.01;
</code></pre>
<p>The <strong>time left</strong> before the next trigger of the timer can be retrieved through the <code>Pending</code> read-only property:</p>
<pre><code class="lang-csharp">timer_object.GetPending();
</code></pre>
<p>The current interval can be <code>Reset</code> with:</p>
<pre><code class="lang-csharp">timer_object.Reset();
</code></pre>
<p>The current interval can also be extended using <code>Delay()</code>, effectively delaying all future triggers of the timer by a given number of <strong>seconds</strong>:</p>
<pre><code class="lang-csharp">timer_object.Delay(1); // In seconds
</code></pre>
<h3 id="pausing-a-timer">Pausing a Timer</h3>
<p>Timers are paused by preventing them from emitting any events, as explained in the <a href="events.html">Events Programming Guide</a>.</p>
<p>Pause a timer with:</p>
<pre><code class="lang-csharp">timer_object.FreezeEvent();
</code></pre>
<p>Resume from the previous time index:</p>
<pre><code class="lang-csharp">timer_object.ThawEvent();
</code></pre>
<h2 id="idlers">Idlers</h2>
<p>When there are no events to process the EFL main loop enters the Idle state, consuming very little CPU power. You can receive a notification when the Idle state starts or stops.</p>
<p>EFL defines three different events you can use to be notified of the above conditions:</p>
<ul>
<li><p><code>IdleEnterEvt</code>: Main loop enters the idle state.</p>
</li>
<li><p><code>IdleExitEvt</code>: Main loop exits the idle state.</p>
</li>
<li><p><code>IdleEvt</code>: Main loop is in the idle state, meaning that it has nothing else to do.</p>
<blockquote>
<p><strong>NOTE:</strong>
This callback will be invoked frequently consuming a significant amount of CPU resources. This also defeats the point of an event-driven application: heavy calculations should be performed on a separate thread or they will block the main loop. This can lead to an unresponsive user interface and other issues.</p>
</blockquote>
</li>
</ul>
<p>Register a callback to be notified of these events using the <code>+=</code> operator, as described in the <a href="events.html">Events Programming Guide</a>.</p>
<p>You can also view the example in the EFL examples repository: <a href="https://git.enlightenment.org/tools/examples.git/tree/reference/csharp/core/src/core_idler.cs"><code>reference/csharp/core/src/core_idler.cs</code></a>.</p>
<h2 id="polling">Polling</h2>
<p>In the rare case where EFL does not provide the event you want, you can resort to conventional application-driven polling. EFL can still manage the scheduling of the periodic polling, calling you back when it is time to perform the poll.</p>
<p>You can choose from among the predefined polling priorities depending on which event you use to register your callback on the application's Main Loop object:</p>
<ul>
<li><p><code>PollHighEvt</code>: For events that may happen multiple times per second.</p>
</li>
<li><p><code>PollMediumEvt</code>: For events that may happen multiple times per minute.</p>
</li>
<li><p><code>PollLowEvt</code>: For events that may happen multiple times every 15 minutes.</p>
</li>
</ul>
<p>The actual polling period is controlled by EFL and can be changed system-wide.</p>
<p>You can find usage examples in the EFL examples repository: <a href="https://git.enlightenment.org/tools/examples.git/tree/reference/csharp/core/src/core_poll.cs"><code>reference/csharp/core/src/core_poll.cs</code></a></p>
<h2 id="further-reading">Further Reading</h2>
<p><a class="xref" href="../../../../../../../api/Efl.Loop.html"><code>Efl.Loop</code> API Reference</a>
:    Detailed documentation for the Loop object (in C)</p>
</article>
          </div>
          
          <div class="hidden-sm col-md-2" role="complementary">
            <div class="sideaffix">
              <div class="contribution">
                <ul class="nav">
                </ul>
              </div>
              <nav class="bs-docs-sidebar hidden-print hidden-xs hidden-sm affix" id="affix">
              <!-- <p><a class="back-to-top" href="#top">Back to top</a><p> -->
              </nav>
            </div>
          </div>
        </div>
      </div>
      
      <footer>
        <div class="grad-bottom"></div>
        <div class="footer">
          <div class="container">
            <span class="pull-right">
              <a href="#top">Back to top</a>
            </span>
            
            <span>Generated by <strong>DocFX</strong></span>
          </div>
        </div>
      </footer>
    </div>
    
    <script type="text/javascript" src="../../../../../../../styles/docfx.vendor.js"></script>
    <script type="text/javascript" src="../../../../../../../styles/docfx.js"></script>
    <script type="text/javascript" src="../../../../../../../styles/main.js"></script>
  </body>
</html>
